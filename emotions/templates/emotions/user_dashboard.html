{% extends 'emotions/base.html' %}

{% block title %}Dashboard | Emotion AI{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header / Welcome -->
    <div
        class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-brand-600 to-accent-600 p-8 md:p-12 text-white shadow-2xl">
        <div class="absolute top-0 right-0 -m-8 h-64 w-64 rounded-full bg-white/10 blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -m-8 h-64 w-64 rounded-full bg-white/10 blur-3xl"></div>

        <div class="relative z-10">
            <h1 class="text-3xl font-bold md:text-5xl mb-4">Welcome back, {{ user.first_name|default:user.username }}!
                üëã</h1>
            <p class="text-brand-100 text-lg max-w-2xl">
                Ready to explore some videos and analyze emotions? Choose a category below to get started.
            </p>

            <!-- Search Bar -->
            <div class="mt-8 max-w-md relative group">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <span class="text-gray-400">üîç</span>
                </div>
                <input type="text"
                    class="block w-full pl-10 pr-3 py-3 rounded-xl border-none text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/50 bg-white/95 shadow-lg transition-all"
                    placeholder="Find a category..." oninput="filterCategories(this.value)">
            </div>
        </div>
    </div>

    <!-- Categories Grid -->
    <div>
        <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
            <span>üìö</span> Browse Categories
        </h2>

        <div id="categoryGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6">
            <div class="col-span-full text-center py-12 text-slate-400">
                <div class="animate-pulse">Loading categories...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Styling configuration for categories
    // Using Tailwind color classes for dynamic assignment would require safelisting everything
    // So we'll stick to inline styles for the specific icon colors, but layout via classes
    const categoryStyles = [
        { icon: '‚öôÔ∏è', color: '#ff7675' },
        { icon: 'üí¨', color: '#55efc4' },
        { icon: 'üë•', color: '#a29bfe' },
        { icon: 'üìç', color: '#0984e3' },
        { icon: 'üìÖ', color: '#fdcb6e' },
        { icon: 'üå§Ô∏è', color: '#74b9ff' },
        { icon: 'üì∑', color: '#00cec9' },
        { icon: 'üéµ', color: '#e84393' },
        { icon: 'üìÅ', color: '#636e72' }
    ];

    async function loadCategories() {
        try {
            const response = await fetch('/api/categories/');
            const data = await response.json();
            const categories = data.results || data;

            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = '';

            categories.forEach((cat, index) => {
                const styleIndex = (index) % categoryStyles.length;
                grid.appendChild(createCategoryCard(cat, styleIndex));
            });

        } catch (error) {
            console.error('Error loading categories:', error);
            grid.innerHTML = '<div class="col-span-full text-center text-red-500">Failed to load categories.</div>';
        }
    }

    function createCategoryCard(cat, styleIndex) {
        const style = categoryStyles[styleIndex] || categoryStyles[categoryStyles.length - 1];

        // Create the card container
        const div = document.createElement('div');
        div.className = 'category-card bg-white rounded-2xl p-6 flex flex-col items-center justify-center gap-4 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer group border border-slate-100 aspect-square';
        div.onclick = () => {
            window.location.href = `/category/${cat.id}/`;
        };

        // Inner HTML
        div.innerHTML = `
            <div class="text-4xl group-hover:scale-110 transition-transform duration-300 select-none" style="filter: drop-shadow(0 4px 6px ${style.color}40);">${style.icon}</div>
            <div class="font-medium text-slate-700 group-hover:text-brand-600 transition-colors text-center">${cat.name}</div>
        `;
        return div;
    }

    function filterCategories(query) {
        const lowerQuery = query.toLowerCase();
        document.querySelectorAll('.category-card').forEach(card => {
            // Text content extraction logic
            const name = card.innerText.toLowerCase();
            card.style.display = name.includes(lowerQuery) ? 'flex' : 'none';
        });
    }

    // Initialize
    loadCategories();
</script>
{% endblock %}